<!DOCTYPE html>
<html>
<head>
<title>ImageLoader Demo</title>
</head>
<body>
<h1>ImageLoader Demo</h1>
<h2>What Is It</h2>
<p>The <code>ImageLoader</code> converts a <code>java.awt.Image</code> into a <code>java.awt.image.BufferedImage</code>.</p>
<h2>How To Use It</h2>
<p>There are three static methods:</p>
<pre>public MutableBufferedImage createImage(Image image)
public MutableBufferedImage createImage(File file)
public MutableBufferedImage createImage(URL url)</pre>
<p>Also three additional methods let you specify the image type (like <code>BufferedImage.TYPE_INT_ARGB</code>, or <code>BufferedImage.TYPE_3BYTE_BGR</code>):</p>
<pre>public MutableBufferedImage createImage(Image image, int imageType)
public MutableBufferedImage createImage(File file, int imageType)
public MutableBufferedImage createImage(URL url, int imageType)</pre>
<h2>How It Works</h2>
<p>It calls <code>Image.getSource()</code> to identify the <code>ImageProducer</code>. Then it attaches a custom <code>ImageConsumer</code> and populates a <code>BufferedImage</code> as image data becomes available.</p>
<p>If you specify a specific image type then the <code>com.pump.image.pixel.ImageType</code> classes are used to convert from one pixel type to another.</code>
<h2>Discussion</h2>
<p>Nothing about this class is especially clever, but it manages a lot of the tedious nuts and bolts of managing pixel data for you.</p>
<p>Originally I intended for the <code>ImageLoader</code> class to be an alternative to the <code>MediaTracker</code> class. (I've always mistrusted (or misunderstood?) that class: why does it require a <code>java.awt.Component</code> to prepare images? Shouldn't there be an unambiguous way to prepare and render <code>java.awt.Images</code> in a headless environment?)</p>
<p>But in hindsight: now I think the <code>ImageLoader</code> is mostly an alternative to loading images with <code>ImageIO</code>. Both approaches produces a <code>BufferedImage</code>, which is nearly always what I prefer instead of a cryptic <code>java.awt.Image</code> from the <code>Toolkit</code>. (I say "cryptic" for a few reasons: there are up to four helper threads that we have no control over that help populate the pixel data. We don't have an easy way to know if an image is loaded, or even if its size has been determined yet. Etc.)</p>
<p>I'm not an expert regarding the <code>MediaTracker</code>, but I poked around a little bit and I found that internally it actually has a very similar approach to the <code>ImageLoader</code>: the <code>sun.awt.image.ImageRepresentation</code> also listens for pixel data and constructs a similar <code>BufferedImage</code>. If that class were part of the Java API I might not written the <code>ImageLoader</code>, but as it stands now: that class remains part of the <code>sun</code> package (although it is <code>public<code>).</p>
<p>Once I realized I was comparing the <code>ImageLoader</code> to <code>ImageIO</code>: I considered discarding the <code>ImageLoader</code>. They produce the same output, and obviously <code>ImageIO</code> has a lot more work put into it. (You can swap parsers, read metadata, etc.) But to my surprise when I started measuring performance: it outperformed <code>ImageIO</code> by a noticeable margin. As of this writing (summer of 2022) when I measure the time it takes to load a large JPG on my Mac the results resemble:</p>
<br><img src="data:image/jvg;base64,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" alt="ImageLoader and MediaTracker takes about 2 seconds, ImageIO takes about 2.5 seconds. ImageLoader takes 17 MB, ImageIO takes 30.5 MB, and MediaTracker takes 41.5 MB."/>
<p>Most of my image needs these days are very simple, though. The user selects an image file and we load it into memory. It doesn't hugely matter if it takes 0.3 seconds or 0.5 seconds. If I ever find myself need to process images in bulk, though, a reduction of 15% in loading time may start to add up.

</body>
</html>